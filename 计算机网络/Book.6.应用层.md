应用层协议是为了解决某一类应用问题，而问题的解决又是通过位于不同主机中的多个应用进程之间的通信和协同工作来完成的。应用层规定了应用进程在通信时所遵循的协议。<u>应用层的许多协议都是基于客户服务器方式的。客户是服务请求方，服务器是服务提供方。</u>

# 域名系统DNS

## 域名系统概述

域名系统 DNS (Domain Name System)是因特网使用的命名系统，用来便于人们使用的机器名字转换成IP地址

互联网的域名系统DNS被设计成为一个<font color=red>***联机分布式数据库系统***</font>，并采用客户服务器方式。DNS使大多数名字都在本地进行解析。由于DNS是分布式系统，即使单个计算机出了故障，也不会妨碍整个DNS系统的正常运行。

## 互联网的域名结构

级别最低的域名写在最左边，而级别最高的顶级域名写在最右边。

如： mail.cctv.com

其中mail为三级域名，cctv为二级域名，com为顶级域名

*注意：域名只是个逻辑概念，并不代表计算机所在的物理地点。点分十进制IP地址汇总一定是包含了三个“."，但每一个域名中“.”的数目则不一定是三个*

## 域名服务器

一个服务器所负责管辖的范围叫做区。区是域的子集。

![](D:\Work\TyporaNotes\note\计算机网络\pict\区的不同划分方法举例.png)

### 树状结构的 DNS 域名服务器

当某个DNS服务器不能进行域名到IP地址的转换时，他就设法找互联网上别的域名服务器进行解析

![](D:\Work\TyporaNotes\note\计算机网络\pict\树状结构的DNS域名服务器.png)

### 域名服务器类型

* 根域名服务器

  根域名服务器是最重要的域名服务器。所有的根域名服务器都知道所有的顶级域名服务器的域名和IP地址

  不管是哪一个本地域名服务器，若要对因特网上任何一个域名进行解析，只要自己无法解析就首先求助于根域名服务器

  在因特网上共有13个不同ip地址的根域名服务器，它们的名字是用一个英文字母命名，从a一直到m

  *注意：根域名服务器并不直接把待查询的域名直接转换成IP地址（根域名服务器也没有存放这种信息），而是告诉本地域名服务器下一步应当找哪一个顶级域名服务器进行查询*

* 顶级域名服务器

  这些域名服务器负责管理在该顶级域名服务器注册的二级域名。当收到DNS查询请求时，就给出相应的回答（<u>可能是最后的结果，也可能是下一步应当找的域名服务器的IP地址</u>）

* 权限域名服务器

  <u>负责一个区的域名服务器</u>。当一个权限域名服务器还不能给出最后的查询回答时，就会发出查询请求的DNS客户，<u>***下一步应当找哪一个权限域名服务器***</u>。

* 本地域名服务器

  当一台主机发出DNS查询请求时，这个查询请求报文就发送给本地域名服务器

  每一个互联网服务提供者ISP，或一个大学，甚至一个大学里的系，都可以拥有一个本地域名服务器，这种域名服务器有时也称为<font color=red>默认域名服务器。</font>

  （本地缓存）

### 域名的解析过程

本地域名服务器采用：

* 迭代查询（使用较多）

![](D:\Work\TyporaNotes\note\计算机网络\pict\本地域名服务器采用迭代查询.png)

查询步骤：

1. 主机m.xyz.com先向其本地域名服务器dns.xyz.com进行<font color=red>递归查询</font>
2. 本地域名服务器采用<font color=red>迭代查询</font>。它先向一个根域名服务器查询
3. 根域名服务器告诉本地域名服务器，下一次应查询的顶级域名服务器dns.com***的IP地址***
4. 本地域名服务器向顶级域名服务器dns.com进行查询
5. 顶级域名服务器dns.com告诉本地域名服务器，下一次应查询的权限域名服务器dns.abc.com的IP地址
6. 本地域名服务器向权限域名服务器dns.abc.com进行查询
7. 权限域名服务器dns.abc.com告诉本地域名服务器，所查询的主机的IP地址
8. 本地域名服务器最后把查询结果告诉主机m.xyz.com

此8个步骤共使用8个UDP用户数据报的报文，经过三次迭代查询。

* 递归查询（比较少用）

![](D:\Work\TyporaNotes\note\计算机网络\pict\本地域名服务器采用递归查询.png)

### 高速缓存

为了提高DNS查询效率，并减轻根域名服务器的负荷和减少互联网上的DNS查询报文数量，在域名服务器上广泛地使用了高速缓存（高速缓存域名服务器）

高速缓存用来存放最近查询过了域名以及从何处获得域名映射信息的记录。

假定本地域名服务器的缓存中并没有y.abc.com的IP地址，而是存放着顶级域名服务器dns.com的IP地址，那么本地域名服务器也可以不向根域名服务器进行查询，而是直接向com顶级域名服务器发送查询请求报文，这样不仅可以大大减轻根域名服务器的负荷，而且也能够使互联网上的DNS查询请求和回答报文的数量大大减少。。



# 文件传送协议

## FTP概述

基于TCP的FTP和基于UDP的简单文件传送协议TFTP

特点：若要存取一个文件，就必须先获得一个本地的文件副本。如要要修改文件，只能对文件的副本进行修改，然后再将修改后的文件副本传回原节点

## FTP的基本工作原理

文件传送协议FTP只提供文件传送的一些基本的服务，它使用TCP可靠的运输服务。FTP使用客户服务器方式。一个FTP服务器进程可同时为多个客户进程提供服务。

FTP的服务器进程由两个部分组成：一个主进程，负责接收新的请求；另外有若干个从属进程，负责处理单个请求

主进程的工作步骤如下：

* 打开熟知端口（端口号为21），使客户进程能够连接上
* 等待客户进程发出连接请求
* 启动从属进程处理客户进程发来的请求。从属进程对客户进程的请求处理完毕后即终止，但从属进程在运行期间根据需要还可能创建其他一些子进程
* 回到等待状态，继续接受其他客户进程发来的请求。主进程与从属进程的处理是并发进行的。

 在进行文件传输时，FTP的客户和服务器之间要建立两个并行的TCP连接：<font color=red>控制连接和数据连接</font>。<u>**实际用于传输文件的是数据连接**</u>



# 远程终端协议TELNET

用户用TELNET就可在其所在地通过TCP连接注册（即登录）到远地的另一台主机上。

TELNET也使用客户服务器方式。在本地系统运行TELNET客户进程，而在远地主机则允许TELNET服务器进程，和FTP的情况相似，服务器中的主进程等待新的请求，并产生从属进程来处理每一个连接

## NVT

适应远地与本地格式差异：产生了**<u>网络虚拟中断NVT(Network Virtual Interception)</u>**

客户软件把用户的击键和命令转换成NVT格式，并送交服务器。服务器软件把收到的数据和命令从NVT格式转换成远地系统所需的格式；向用户返回数据时，服务器把远地系统的格式转换成NVT格式，本地客户再从NVT格式转换到本地系统所需的格式。



# 万维网WWW

## 万维网概述

万维网是一个大规模的、联机式的信息储藏所。万维网提供分布式服务 。

万维网是分布式超媒体(hypermedia)系统，它是超文本(hypertext)系统的扩充。

万维网以客户服务器方式工作。

问题：

* <u>怎样标志分布在整个因特网上的万维网文档？</u> 

  <u>URL</u>

* 用何协议实现万维网上各种超链接的链接？ 

  HTTP

* 怎样使各种万维网文档都能在因特网上的各种计算机上显示出来？

  HTML

* 怎样使用户能够很方便地找到所需的信息？

  搜索工具（即搜索引擎）

## 统一资源定位符URL

URL 相当于一个文件名在网络范围的扩展。因此 URL 是与因特网相连的机器上的任何可访问对象的一个指针。  

URL的一般形式由以下四个部分组成：

​	<协议>://<主机>(:<端口>/<路径>) 

（）内的有时可省略

使用http的URL：

​	http://<主机>:<端口>/<路径>

http的默认端口为80，通常为省略

## 超文本传送协议HTTP

### HTTP的操作过程

<u>HTTP是面向事务的应用层协议</u>，它是万维网上能够可靠地交换文件的重要基础。

![](D:\Work\TyporaNotes\note\计算机网络\pict\万维网的工作过程.png)

<u>HTTP协议本身是无连接的，虽然HTTP使用了TCP连接，但通信的双方在交换HTTP报文之前不需要先建立HTTP连接。</u>

<u>HTTP协议是无状态的。</u>同一个客户在第二次访问同一个服务器上的页面时，服务器的响应与第一次被访问时相同，因为服务器不记得曾经访问过这个客户，也不记得为客户曾经服务过多少次，HTTP的无状态特性简化了服务器的设计，使服务器更容易支持大量并发的HTTP请求。

用户点击鼠标链接某个万维网文档时，HTTP协议要和服务器建立TCP连接，需要使用三次握手。

![](D:\Work\TyporaNotes\note\计算机网络\pict\请求一个万维网文档所需的时间.png)

#### 例：若用户点击www.tsinghua.edu.cn/chn/ysxz/index.html后，发生了什么事件

1. 浏览器分析超链接指向页面的URL

2. 浏览器向DNS请求解析www.tsinghua.edu.cn的IP地址

3. 域名系统DNS解析出清华大学服务器的IP地址

4. 浏览器与服务器建立TCP连接

5. 浏览器发出取文件命令

   GET /chn/ysxz/index.html

6. 服务器给出响应，把文件index.html发给浏览器

7. TCP连接释放

8. 浏览器显示“清华大学院系设置”文件index.html中的所有文本

请求一个万维网所需要的时间是该文档的传输时间加上两倍往返时间RTT（一个RTT用于连接TCP连接，另一个RTT用于请求和接收万维网文档）

由此可看到HTTP/1.0的主要缺点：

* 请求一个文档就要有两倍RTT的开销
* 万维网客户和服务器每一次建立新的TCP连接都要重新分配缓存和变量（非持续连接）

HTTP/1.1使用了持续连接，即万维网服务器在发送响应后仍然在一段时间内保持这条连接，使同一个客户和该服务器可以继续在这条连接上传送后续的HTTP请求报文和响应报文。

HTTP/1.1持续连接有两种工作方式，非流水线方式和流水线方式

**非流水线方式：客户收到前一个响应后才能发出下一个请求**

**流水线方式：客户收到HTTP的响应报文之前就能够接着发送新的请求报文**（提高了效率）

### 代理服务器

<u>代理服务器(proxy server)又称为万维网高速缓存(Web cache)。</u>

代理服务器把最近的一些请求和响应暂存在本地磁盘中。当新请求到达时，若代理服务器发现这个请求与暂时存放的请求相同，就返回暂存的响应，而不需要按URL的地址再次去互联网访问该资源。

代理服务器可用在客户端或服务器端工作，也可在中间系统上工作。

使用高速缓存可减少访问因特网服务器的时延 。

![](D:\Work\TyporaNotes\note\计算机网络\pict\不使用代理服务器.png)

![](D:\Work\TyporaNotes\note\计算机网络\pict\使用代理服务器.png)

#### 若校园网使用了代理服务器，访问互联网的过程

1. 计算机先和校园网的代理服务器建立TCP连接，并向代理服务器发出HTTP请求报文
2. 若代理服务器已经存放了所请求的对象，代理服务器就把这个对象放入HTTP响应报文中返回给计算机的浏览器
3. 否则，代理服务器就代表发出请求的用户浏览器，与互联网上的源点服务器建立TCP连接，并发送HTTP请求报文
4. 源点服务器把所请求的对象放在HTTP响应报文中返回给校园网的代理服务器
5. 代理服务器收到这个对象后，先复制在自己的本地存储器中（留待以后用），然后再把这个对象放在HTTP响应报文中，通过已建立的TCP连接，返回给请求该对象的浏览器

可见，代理服务器有时是作为服务器（当接受浏览器的HTTP请求时），有时却作为客户（当向互联网上的源点服务器发送HTTP请求时）

### HTTP的报文结构

由于HTTP是面向文本的，因此在报文中的每一个字段都是一些ASCII码串

## 万维网的文档

### HLTM

并不是应用层的协议，只是万维网使用的一种语言

并非所有的浏览器都支持HTML语言，不支持时，浏览器会忽略此标签，只显示中间的文本

### 动态万维网文档

动态文档和静态文档之间的主要差别体现在服务器一段

## 万维网的信息检索系统

在万维网中用来进行搜索的工具叫做搜索引擎，包括：

* 全文检索搜索引擎
* 分类目录搜索引擎











