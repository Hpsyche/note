## 物理层

* 若两台主机：

  网线----（电脑连电脑），两台电脑已经构成了一个最小的局域网

* 若三台主机：

  使用hub（集线器）

  这种设备有多个口，可以将宿舍里的多台电脑连接起来。但是，和交换机不同，集线器没有大脑，它完全在物理层工作。它会将自己收到的每一个字节，都复制到其他端口上去。这是第一层物理层联通的方案。

## 数据链路层

你可能已经发现问题了。Hub 采取的是广播的模式，如果每一台电脑发出的包，宿舍的每个电脑都能收
到，那就麻烦了。这就需要解决几个问题：
1. 这个包是发给谁的？谁应该接收？
2. 大家都在发，会不会产生混乱？有没有谁先发、谁后发的规则？
3. 如果发送的时候出现了错误，怎么办？
这几个问题，都是第二层，数据链路层，也即 MAC 层要解决的问题。MAC的全称是Medium Access
Control，即媒体访问控制。控制什么呢？其实就是控制在往媒体上发数据的时候，谁先发、谁后发的问
题。防止发生混乱。

* 第二个问题的解决：

  比如接下来这三种方式：
  方式一：分多个车道。每个车一个车道，你走你的，我走我的。这在计算机网络里叫作信道划分；
  方式二：今天单号出行，明天双号出行，轮着来。这在计算机网络里叫作轮流协议；
  方式三：不管三七二十一，有事儿先出门，发现特堵，就回去。错过高峰再出。我们叫作随机接入协
  议。著名的以太网，用的就是这个方式。

* 第一个问题的解决：

  当源机器知道目标机器的时候，可以将目标地址放入包里面，如果不知
  道呢？一个广播的网络里面接入了 N 台机器，我怎么知道每个 MAC 地址是谁呢？这就是ARP 协议，也
  就是已知 IP 地址，求 MAC 地址的协议。

  ![](D:\Work\TyporaNotes\note\计算机网络\趣谈网络协议知识点\pict\5-1.png)

  ![](D:\Work\TyporaNotes\note\计算机网络\趣谈网络协议知识点\pict\5-2.png)

  为了避免每次都用 ARP 请求，机器本地也会进行 ARP 缓存。当然机器会不断地上线下线，IP 也可能会
  变，所以 ARP 的 MAC 地址缓存过一段时间就会过期。

## 交换机引入

这种组网的方法，对一个宿舍来说没有问题，但是一旦机器数目增多，问题就出现了。因为 Hub 是广播
的，不管某个接口是否需要，所有的 Bit 都会被发送出去，然后让主机来判断是不是需要。这种方式路
上的车少就没问题，车一多，产生冲突的概率就提高了。而且把不需要的包转发过去，纯属浪费。看来
Hub 这种不管三七二十一都转发的设备是不行了，需要点儿智能的。因为每个口都只连接一台电脑，这
台电脑又不怎么换 IP 和 MAC 地址，只要记住这台电脑的 MAC 地址，如果目标 MAC 地址不是这台电
脑的，这个口就不用转发了。

谁能知道目标 MAC 地址是否就是连接某个口的电脑的 MAC 地址呢？这就需要一个能把 MAC 头拿下
来，检查一下目标 MAC 地址，然后根据策略转发的设备，按第二节课中讲过的，这个设备显然是个二
层设备，我们称为交换机。

交换机怎么知道每个口的电脑的 MAC 地址呢？这需要交换机会学习。

一台 MAC1 电脑将一个包发送给另一台 MAC2 电脑，当这个包到达交换机的时候，一开始交换机也不
知道 MAC2 的电脑在哪个口，所以没办法，它只能将包转发给出了来的那个口之外的其他所有的口。但
是，这个时候，交换机会干一件非常聪明的事情，就是**交换机会记住，MAC1 是来自一个明确的口。以
后有包的目的地址是 MAC1 的，直接发送到这个口就可以了。**

当交换机作为一个关卡一样，过了一段时间之后，就有了整个网络的一个结构了，这个时候，基本上不
用广播了，全部可以准确转发。当然，每个机器的 IP 地址会变，所在的口也会变，因而交换机上的学习
的结果，我们称为转发表，是有一个过期时间的。