收获：

![](D:\Work\TyporaNotes\note\计算机网络\趣谈网络协议知识点\pict\购物流程图.png)

流程：

1. 在应用层封装后发送给传输层，传输层封装发送给网络层时，由于需要出去外地，需要通过网关，此时操作系统会寻找本地ip如192.168.1.1的MAC地址（通过ARP协议），即网关的MAC；
2. 此时网关通过路由器中的路由表（路由协议：OSPF和BGP）经过一个个网关，最终达终点的网关；
3. 在最终网关处，操作系统寻找如网关对应的MAC地址，然后取出头部向上层传送。

注意：

1. 为什么需要mac地址呢，ip地址貌似可以实现传输了？

   ip可以保证要发送的包在网络中传输，到达目标服务器所在的局域网的网关，但是到了网关后，ip就没有用了，因为局域网中的ip对应的机器是不确定的，可能今天对应A机器，明天对应B机器。所以在局域网中使用ip寻址是不严谨的，这时就需要mac地址来唯一对应一台机器，这样网络包就可以准确的传输到需要的主机上了。

   或者说，mac地址用于局域网寻址，ip用于网络寻址。

   （局域网内IP地址是动态分配的，假如我是192.168.2.100，如果我下线了，可能IP就分配给了另一台电脑。IP和设备并不总是对应的，这对通信就产生了问题，但是MAC地址不同，MAC地址和设备是一一对应且全球唯一的。所以局域网使用MAC地址通信没有问题。）



扩展：

当网络包到达一个城关的时候，可以通过路由表得到下一个城关的IP 地址，直接通过 IP 地址找就可以了，为什么还要通过本地的 MAC 地址呢？

1.局域网内IP地址是动态分配的，假如我是192.168.2.100，如果我下线了，可能IP就分配给了另一台电脑。IP和设备并不总是对应的，这对通信就产生了问题，但是MAC地址不同，MAC地址和设备是一一对应且全球唯一的。所以局域网使用MAC地址通信没有问题。

2.历史遗留问题：早期的以太网只有交换机，没有路由器，以太网内通过MAC地址通信。后来才有了互联网，为了兼容原本的模式，采用了IP+MAC地址通信的方式。为啥不推到了重来呢？看看IPv6的处境你就知道了。所以是先有MAC地址后有的IP，IP的提出主要还是因为MAC地址本身的缺陷，这个问题换成有了MAC为何还要IP地址也很有意思。

3.我这里简单说一下第一：MAC地址本身的缺陷：因为MAC地址是硬件提供商写在网卡中的，MAC地址虽然唯一但是不能表明用户在整个互联网中的位置，除非维护一个超级大MAC地址对应表，那寻址效率肯定爆炸。但是IP地址解决了这个问题，因为IP地址是网络提供商给你的，所以你在哪里整个网络都是知道的。第二：安全问题：获取MAC地址是通过ARP协议来完成的，如果只用MAC地址通信，那么广播风暴是个难题。

4.那么我觉得如果哪天每人一个固定的IPv6地址，那么我觉得MAC地址+IPv4的模式是不是可以被替换了？



有比较过 Http 和 RPC 吗？

1.rpc只是一种概念，实现rpc的方式有很多种，但本质上都需要客户端和服务端之间有一个通信协议，这个协议用于规范两个进程通过网络传输数据时数据的格式，一边按照协议把数据装配好通过网络传输，另一边按照协议把接收的二进制数据翻译成有用的数据，这个协议一定是两端商量好使用同一种的。也就是类似两个人交流，需要一个双方都懂的语言，一边说汉语一边说英语肯定是无法提供交流的，两边都说同一种话才能交流，一边通过语言的定义把他要表达的意图/想法转换成文字/发音提交给另一方，另一方通过语言的定义，在大脑中将文字翻译为真正要表达的东西。

2.并且协议是不可能没有的，比如就算你用Java的序列化方式来传输数据，那也是按Java序列化规范了数据格式，那也是一种两端都协定好的协议；亦或是你自己实现了某种传输的数据的格式，通信的两端都可以用你的规范下编写的编解码工具来处理/翻译数据，这也是一种协议。就好像原始人交流，通过呃呃啊啊几个简单音节配以手舞足蹈的动作，这种“语言”虽然简陋，但也实现了交流的目的，那他就是原始人的语言。

3.所以这个协议可以是soap协议，也可以是http协议，你不能说用http协议交流的远程过程调用就不算rpc了，用什么协议是服务端和客户端在开发时决定的，本质上是实现rpc，只是每个协议都有其自己的特性，不同的协议之间，会有一些比较大的区别，差异比较大的一个例子，比如说利用Json传输数据，翻译和构造都非常耗时，数据也很大，优点是开发人员友好，数据可读性强，调试方便，而使用Hession、protobuf，数据处理快，可读性差，优点就是快，但这个快体现在数据量小、处理快，和网络没有关系。

4.综上，RPC和HTTP根本不是一个层面的东西

良好的rpc调用是面向服务的封装，针对服务的可用性和效率等都做了优化。单纯使用http调用则缺少了这些特性。

