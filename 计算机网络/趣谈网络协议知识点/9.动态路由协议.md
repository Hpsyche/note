## 距离矢量路由算法

基于Ford算法的

### 算法

* 这种算法的基本思路是，每个路由器都保存一个路由表，包含多行，每行对应网络中的一个路由器，每
  一行包含两部分信息，一个是要到目标路由器，从那条线出去，另一个是到目标路由器的距离。
* 由此可以看出，每个路由器都是知道全局信息的。那这个信息如何更新呢？每个路由器都知道自己和邻
  居之间的距离，每过几秒，每个路由器都将自己所知的到达所有的路由器的距离告知邻居，每个路由器
  也能从邻居那里得到相似的信息。
* 每个路由器根据新收集的信息，计算和其他路由器的距离，比如自己的一个邻居距离目标路由器的距离
  是 M，而自己距离邻居是 x，则自己距离目标路由器是 x+M。

### 问题

* 第一个问题就是好消息传得快，坏消息传得慢。如果有个路由器加入了这个网络，它的邻居就能很快发
  现它，然后将消息广播出去。要不了多久，整个网络就都知道了。但是一旦一个路由器挂了，挂的消息
  是没有广播的。当每个路由器发现原来的道路到不了这个路由器的时候，感觉不到它已经挂了，而是试
  图通过其他的路径访问，直到试过了所有的路径，才发现这个路由器是真的挂了。

  ![](D:\Work\TyporaNotes\note\计算机网络\趣谈网络协议知识点\pict\9-1.png)

  * 这种算法的第二个问题是，每次发送的时候，要发送整个全局路由表。网络大了，谁也受不了，所以最早的路由协议 RIP 就是这个算法。它适用于小型网络（小于 15 跳）。当网络规模都小的时候，没有问题。现在一个数据中心内部路由器数目就很多，因而不适用了。

    所以上面的两个问题，限制了距离矢量路由的网络规模。

  

## 链路状态路由算法

基于Djkstra算法。

### 算法

* 当一个路由器启动的时候，首先是发现邻居，向邻居 say hello，邻居都回复。然后计算和邻居的距离，发送一个 echo，要求马上返回，除以二就是距离。然后将自己和邻居之间的链路状态包广播出去，发送到整个网络的每个路由器。这样每个路由器都能够收到它和邻居之间的关系的信息。因而，每个都能在自己本地构建一个完整的图，然后针对这个图使用 Dijkstra 算法，找到两点之间的最短路径。不像距离距离矢量路由协议那样，更新时发送整个路由表。链路状态路由协议只广播更新的或改变的网络拓扑，这使得更新信息更小，节省了带宽和 CPU 利用率。而且一旦一个路由器挂了，它的邻居都会广
  播这个消息，可以使得坏消息迅速收敛。

## 动态路由协议

### 基于链路状态路由算法的 OSPF

OSPF（Open Shortest Path First，开放式最短路径优先）就是这样一个基于链路状态路由协议，广泛
应用在数据中心中的协议。

由于主要用在数据中心内部，用于路由决策，因而称为内部网关协议（简称IGP）。

内部网关协议的重点就是找到最短的路径。在一个组织内部，路径最短往往最优。当然有时候 OSPF 可
以发现多个最短的路径，可以在这多个路径中进行负载均衡，这常常被称为等价路由。

这一点非常重要。有了等价路由，到一个地方去可以有相同的两个路线，可以分摊流量，还可以当一条
路不通的时候，走另外一条路。



* 好了，这一节就到这里了，我来做个总结：

  路由分静态路由和动态路由，静态路由可以配置复杂的策略路由，控制转发策略；

  动态路由主流算法有两种，距离矢量算法和链路状态算法。基于两种算法产生两种协议，BGP 协议和
  OSPF 协议。