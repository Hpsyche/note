## 性能是什么

衡量性能的两个标准：

* 响应时间（Response	time）或者叫执行时间（Execution	time）。想要提升响应时间这个性能指标，你可以理解为让计算机“跑得更快”。
* 吞吐率（Throughput）或者带宽（Bandwidth），想要提升这个指标，你可以理解为让计算机“搬得更多”。

## 如何优化性能

### 计算机的计时单位：CPU时钟

时间是一个很自然的用来衡量性能的指标，但是用时间来衡量时，有两个问题。

* 第一个就是时间不“准”。如果用你自己随便写的一个程序，来统计程序运行的时间，每一次统计结果不会
  完全一样。有可能这一次花了45ms，下一次变成了53ms。

  运行一下time命令。它会返回三个值，第一个是real time，也就是我们说的Wall Clock Time，也就
  是运行程序整个过程中流逝掉的时间；第二个是user time，也就是CPU在运行你的程序，在用户态运行指
  令的时间；第三个是sys time，是CPU在运行你的程序，在操作系统内核里运行指令的时间。

  **而程序实际花费的CPU执行时间（CPU Time），就是user time加上sys time。**

* 其次，即使我们已经拿到了CPU时间，我们也不一定可以直接“比较”出两个程序的性能差异。即使在同一
  台计算机上，CPU可能满载运行也可能降频运行，降频运行的时候自然花的时间会多一些。

* 除了CPU之外，时间这个性能指标还会受到主板、内存这些其他相关硬件的影响。

  > **程序的CPU执行时间=CPU时钟周期数×时钟周期时间**

  * 时钟周期时间，买电脑的时候，CPU有个主频，比如主频为2.8GHz，则这个时钟周期时间，就是1/2.8G。

    所以，对于减少CPU执行时间，最简单的提升性能方案，自然就是缩短时钟周期时间，也就是提升主频。换句话说，就是换一块好一点的CPU。

    不过，这个是我们这些软件工程师控制不了的事情，所以我们就把目光挪到了乘法的另一个因子——CPU时钟周期数上。如果能够**减少程序需要的CPU时钟周期数量，一样能够提升程序性能。**

  * 对于CPU时钟周期数，我们可以再做一个分解，把它变成“**指令数×每条指令的平均时钟周期数**（Cycles	PerInstruction，简称CPI）”。不同的指令需要的Cycles是不同的，加法和乘法都对应着一条CPU指令，但是乘法需要的Cycles就比加法要多，自然也就慢。

    在这样拆分了之后，我们的程序的CPU执行时间就可以变成这样三个部分的乘积。

    > **程序的CPU执行时间=指令数×CPI×Clock Cycle Time**

### 性能的优化

因此，如果我们想要解决性能问题，其实就是要优化以上指令数×CPI×Clock Cycle Time三者。

1. 时钟周期时间，就是计算机主频，这个取决于计算机硬件。我们所熟知的摩尔定律就一直在不停地提高我们计算机的主频。比如说，我最早使用的80386主频只有33MHz，现在手头的笔记本电脑就有2.8GHz，在主频层面，就提升了将近100倍。
2. 每条指令的平均时钟周期数CPI，就是一条指令到底需要多少CPU Cycle。在后面讲解CPU结构的时候，我们会看到，**现代的CPU通过流水线技术（Pipeline），让一条指令需要的CPU Cycle尽可能地少。**因此，对于CPI的优化，也是计算机组成和体系结构中的重要一环。
3. **指令数，代表执行我们的程序到底需要多少条指令、用哪些指令。这个很多时候就把挑战交给了编译
器。同样的代码，编译成计算机指令时候，就有各种不同的表示方式。**

