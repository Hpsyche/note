# 常用的SQL函数

* 算术函数
* 字符串函数
* 日期函数
* 转换函数

## 算术函数

* ABS()
* MOD()
* ROUND()：四舍五入为指定小数位数，需要两个参数（字段名称，小数位数）

## 字符串函数

* CONCAT()
* LENGTH()
* CHAR_LENGTH()
* LOWER()
* UPPER()
* REPLACE()
* SUBSTRING()

## 日期函数

* CURRENT_DATE()
* CURRENT_TIME()：系统当前时间，没有具体的日期
* CURRENT_TIMESTAMP()：系统当前时间，包括具体的日期+时间
* EXTRACT()：抽取具体的年月日
* DATE()：返回时间的日期部分
* YEAR()：返回时间的年份部分
* MONTH()：返回时间的月份部分
* DAY()：返回时间的天数部分
* HOUR()：返回时间的小时部分
* MINUTE()：返回时间的分钟部分
* SECOND()：返回时间的秒部分

```sql
SELECT EXTRACT(YEAR FROM '2019-04-03')
/*
运行结果为2019
*/
SELECT DATE('2019-04-01 12:00:05')
/*
运行结果为 2019-04-01
*/
```

注意：**DATE 日期格式必须是 yyyy-mm-dd 的形式。如果要进行日期比较，就要使用 DATE 函数，不要直接使用日期与字符串进行比较。**

## 转换函数

转换函数可以转换数据之间的类型，常用的函数如下表所示：

* CAST()：数据类型转换，参数是一个表达式，表达式通过AS关键词分割了2个参数，分别是原始数据和目标数据类型
* COALESCE()：返回第一个非空数值

```sql
SELECT CAST(123.123 AS INT)
/**
运行结果会报错。
*/
SELECT CAST(123.123 AS DECIMAL(8,2))
/**
运行结果为 123.12。
*/
SELECT COALESCE(null,1,2)
/**
运行结果为 1。
*/
```

CAST 函数在转换数据类型的时候，不会四舍五入，如果原数值有小数，那么转换为整数类型的时候就会报错。

不过你可以指定转化的小数类型，在 MySQL 和 SQL Server 中，你可以用`DECIMAL(a,b)`来指定，其中 a 代表整数部分和小数部分加起来最大的位数，b 代表小数位数，比如`DECIMAL(8,2)`代表的是精度为 8 位（整数加小数位数最多为 8 位），小数位数为 2 位的数据类型。所以`SELECT CAST(123.123 AS DECIMAL(8,2))`的转换结果为 123.12。

假设我们需要找出在 2016 年 10 月 1 日之后上线的所有英雄。这里我们可以采用 DATE 函数来判断 birthdate 的日期是否大于 2016-10-01，即`WHERE DATE(birthdate)>'2016-10-01'`，然后再显示符合要求的全部字段信息，即：

```sql
SQL： SELECT * FROM heros WHERE DATE(birthdate)>'2016-10-01'
```

需要注意的是下面这种写法是不安全的：

```sql
SQL:  SELECT * FROM heros WHERE birthdate>'2016-10-01'
```

因为很多时候你无法确认 birthdate 的数据类型是字符串，还是 datetime 类型，如果你想对日期部分进行比较，那么使用`DATE(birthdate)`来进行比较是更安全的。

## SQL函数带来的问题

尽管 SQL 函数使用起来会很方便，但我们使用的时候还是要谨慎，因为你使用的函数很可能在运行环境中无法工作，这是为什么呢？

我们在使用 SQL 语言的时候，不是直接和这门语言打交道，而是通过它使用不同的数据库软件，即 DBMS。DBMS 之间的差异性很大，远大于同一个语言不同版本之间的差异。实际上，只有很少的函数是被 DBMS 同时支持的。比如，大多数 DBMS 使用（||）或者（+）来做拼接符，而在 MySQL 中的字符串拼接函数为`CONCAT()`。。大部分 DBMS 会有自己特定的函数，这就意味着采用 SQL 函数的代码可移植性是很差的，因此在使用函数的时候需要特别注意。

## 关于大小写的规范

细心的人可能会发现，我在写 SELECT 语句的时候用的是大写，而你在网上很多地方，包括你自己写的时候可能用的是小写。实际上在 SQL 中，关键字和函数名是不用区分字母大小写的，比如 SELECT、WHERE、ORDER、GROUP BY 等关键字，以及 ABS、MOD、ROUND、MAX 等函数名。

不过在 SQL 中，你还是要确定大小写的规范，因为在 Linux 和 Windows 环境下，你可能会遇到不同的大小写问题。

**MySQL 在 Linux 的环境下，数据库名、表名、变量名是严格区分大小写的，而字段名是忽略大小写的。**

 **MySQL 在 Windows 的环境下全部不区分大小写。**

这就意味着如果你的变量名命名规范没有统一，就可能产生错误。这里有一个有关命名规范的建议：

* 关键字和函数名称全部大写；
* 数据库名、表名、字段名称全部小写；
* SQL 语句必须以分号结尾。

虽然关键字和函数名称在 SQL 中不区分大小写，也就是如果小写的话同样可以执行，但是数据库名、表名和字段名在 Linux MySQL 环境下是区分大小写的，因此建议你统一这些字段的命名规则，比如全部采用小写的方式。同时将关键词和函数名称全部大写，以便于区分数据库名、表名、字段名。

